<?xml version='1.0' encoding='utf-8'?>
<odoo>

  <record model="ir.ui.view" id="inherited_helpdesk_ticket_view_form">
    <field name="name">inherited helpdesk ticket view form</field>
    <field name="model">helpdesk.ticket</field>
    <field name="inherit_id" ref="helpdesk.ticket_view_form"/>
    <field name="arch" type="xml">
      <xpath expr="//group[@name='global']" position="after">
        <group name="project-task">
          <group name="task">
            <field name="project_id"
                   options='{"no_create": True}'/>
            <field name="task_id"
                   options='{"no_create": True}'
                   required="1"/>
            <field name="progress"
                   widget="progressbar"
                   attrs="{'invisible': [('task_id', '=', False)]}" />
          </group>
          <group name="invisible" invisible="1">
            <field name="analytic_account_active" invisible="1"/>
            <field name="allow_timesheets" invisible="1"/>
            <field name="service_policy" invisible="1"/>
          </group>
          <group name="hours" attrs="{'invisible': [('task_id', '=', False)]}" colspan="4">
            <notebook>
              <page string="Timesheets">
                <group name="timesheet_error" attrs="{'invisible': [('analytic_account_active', '!=', False)]}">
                  <div class="alert alert-warning" role="alert">
                    You can not log timesheets on this project since is linked to an inactive analytic account. Please change it, or reactivate the current one to timesheet on the project.
                  </div>
                </group>
                <group name="timesheet_error" attrs="{'invisible': [('allow_timesheets', '=', 'False'), ('service_policy', '!=', 'ordered_timesheet')]}">
                  <div class="alert alert-warning" role="alert">
                    You can not log timesheets on this project since is linked to an ordered timesheet product.
                  </div>
                </group>
                <field name="timesheet_ids" mode="tree,kanban" attrs="{'invisible': [('analytic_account_active', '=', False)]}" context="{'default_project_id': project_id, 'default_name':''}">
                  <tree editable="bottom" string="Timesheet Activities" default_order="date" attrs="{'readonly': [('allow_timesheets', '=', 'False'), ('service_policy', '!=', 'ordered_timesheet')]}">
                    <field name="date"/>
                    <field name="user_id" invisible="1"/>
                    <field name="employee_id" required="1"/>
                    <field name="name"/>
                    <field name="unit_amount" widget="timesheet_uom"/>
                    <field name="project_id" invisible="1"/>
                  </tree>
                  <kanban class="o_kanban_mobile">
                    <field name="date"/>
                    <field name="user_id"/>
                    <field name="employee_id"/>
                    <field name="name"/>
                    <field name="unit_amount"/>
                    <field name="project_id"/>
                    <templates>
                      <t t-name="kanban-box">
                        <div t-attf-class="oe_kanban_card oe_kanban_global_click">
                          <div class="row">
                            <div class="col-6">
                              <strong>
                                <span><t t-esc="record.employee_id.value"/></span>
                              </strong>
                            </div>
                            <div class="col-6 pull-right text-right">
                              <strong><t t-esc="record.date.value"/></strong>
                            </div>
                          </div>
                          <div class="row">
                            <div class="col-6 text-muted">
                              <span><t t-esc="record.name.value"/></span>
                            </div>
                            <div class="col-6">
                              <span class="pull-right text-right">
                                <field name="unit_amount" widget="float_time"/>
                              </span>
                            </div>
                          </div>
                        </div>
                      </t>
                    </templates>
                  </kanban>
                  <form string="Timesheet Activities">
                    <sheet>
                      <group>
                        <field name="date"/>
                        <field name="user_id" invisible="1"/>
                        <field name="employee_id" required="1"/>
                        <field name="name"/>
                        <field name="unit_amount" string="Duration" widget="float_time"/>
                        <field name="project_id" invisible="1"/>
                      </group>
                    </sheet>
                  </form>
                </field>
                <group attrs="{'invisible': [('analytic_account_active', '=', False)]}">
                  <group class="oe_subtotal_footer oe_right" name="project_hours" colspan="4">
                    <field name="planned_hours" widget="float_time"/>
                    <field name="effective_hours" widget="float_time"/>
                    <field name="subtask_effective_hours" widget="float_time" attrs="{'invisible' : [('subtask_effective_hours', '=', 0.0)]}"/>
                    <field name="total_hours_spent" widget="float_time" class="oe_subtotal_footer_separator" attrs="{'invisible' : [('subtask_effective_hours', '=', 0.0)]}"/>
                    <field name="remaining_hours" widget="float_time" class="oe_subtotal_footer_separator"/>
                  </group>
                </group>
              </page>
            </notebook>
          </group>
        </group>
      </xpath>
    </field>
  </record>

</odoo>
